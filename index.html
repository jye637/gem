<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è”¡æ–‡åœ‹å°20251226Gemå¢èƒ½ç ”ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Fredoka+One&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; scroll-behavior: smooth; }
        .vibrant-bg { background: linear-gradient(120deg, #fdfbfb 0%, #ebf8ff 100%); }
        .card-pop { 
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.08);
            transition: all 0.3s ease;
        }
        @media (min-width: 1024px) {
    .poster-container {
        max-width: 620px; /* æŠ•å½±æˆ–ç ”ç¿’æ•™å®¤æ›´èˆ’æœ */
    }
}
        .card-pop:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(59, 130, 246, 0.12); }
        .nav-button {
            padding: 8px 16px;
            border-radius: 12px;
            transition: all 0.2s;
            color: #4b5563;
        }
        .nav-button:hover { background: #eff6ff; color: #2563eb; }
        .nav-button.active { background: #2563eb; color: white; }
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .content-wrap { white-space: pre-wrap; word-break: break-all; }
        
        /* åŠ è¼‰å‹•ç•« */
        .spinner {
            animation: rotate 2s linear infinite;
            width: 24px;
            height: 24px;
            border: 3px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
        }
        @keyframes rotate { 100% { transform: rotate(360deg); } }

                @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');

        :root {
            --bg-color: #0a1f44; /* æ·±è—èƒŒæ™¯ */
            --card-bg: linear-gradient(145deg, #0f2c5e, #0a1f44);
            --gold: #d4af37;     /* é‡‘è‰²è£é£¾ */
            --text-white: #ffffff;
            --xmas-red: #c41e3a;  /* è–èª•ç´… */
        }
        .main-layout {
    display: grid;
    grid-template-columns: 1fr;   /* é è¨­ï¼šæ‰‹æ©Ÿç›´å¼ */
}
        @media (min-width: 1024px) {
    .main-layout {
        grid-template-columns: 1.1fr 1.4fr; /* æ¡Œæ©Ÿæ©«å¼ */
    }
}
        .hero {
    border-bottom: 4px solid var(--gold);
}
@media (min-width: 1024px) {
    .hero {
        border-bottom: none;
        border-right: 4px solid var(--gold);
    }
}




                body {
            margin: 0;
            padding: 20px 10px;
            background-color: #051229; /* ç¶²é èƒŒæ™¯æ›´æ·±ä¸€é» */
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(212, 175, 55, 0.05) 10px, rgba(212, 175, 55, 0.05) 11px),
                radial-gradient(circle at top, rgba(255,255,255,0.1) 0%, transparent 60%);
        }

                /* æµ·å ±ä¸»é«”å®¹å™¨ */
        .poster-container {
    background-color: var(--bg-color);
    width: 100%;
    max-width: min(90vw, 520px); /* æ‰‹æ©Ÿå‹å–„ + æ¡Œæ©Ÿä¸æœƒå¤ªçª„ */
    margin: 0 auto;
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    border: 2px solid var(--gold);
    position: relative;
}


        /* è£é£¾ç·šæ¢ */
        .circuit-lines {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0.1;
            pointer-events: none;
            background: 
                linear-gradient(90deg, var(--gold) 1px, transparent 1px) 0 0 / 20px 20px,
                linear-gradient(0deg, var(--gold) 1px, transparent 1px) 0 0 / 20px 20px;
            z-index: 0;
        }

        /* å…§å®¹å±¤ç´š */
        .content-layer {
            position: relative;
            z-index: 1;
            padding-bottom: 20px;
        }

        /* é ‚éƒ¨è–èª•æ©«å¹… */
        .xmas-banner {
            background-color: var(--xmas-red);
            color: var(--text-white);
            text-align: center;
            padding: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            border-bottom: 2px solid var(--gold);
        }

        /* æ¨™é¡Œå€ */
        .header-section {
            text-align: center;
            padding: 20px 15px 10px;
        }
        .school-name {
            color: var(--text-white);
            font-size: 1.2rem;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        .main-title {
            color: var(--gold);
            font-size: 1.6rem;
            font-weight: 700;
            margin: 0;
            line-height: 1.3;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .sub-title {
            color: var(--text-white);
            font-size: 1.3rem;
            margin: 5px 0 15px;
        }
        .gem-icon {
            font-size: 1.5rem;
            vertical-align: middle;
        }

        /* è¬›å¸«èˆ‡è³‡è¨Šå€ (æ ¸å¿ƒä½ˆå±€) */
        .info-section {
            display: flex;
            flex-wrap: wrap; /* æ‰‹æ©Ÿä¸Šè‡ªå‹•æ›è¡Œ */
            align-items: center;
            justify-content: center;
            gap: 20px;
            padding: 15px;
            margin: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* è¬›å¸«ç…§ç‰‡ */
        .profile-wrapper {
            flex: 0 0 auto;
            position: relative;
        }
        .profile-img {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--gold);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            /* åŠ ä¸Šè–èª•å¸½è£é£¾ (ç”¨CSSæ¨¡æ“¬) */
        }
        .profile-wrapper::after {
            content: 'ğŸ…';
            position: absolute;
            top: -10px;
            right: -5px;
            font-size: 2rem;
            transform: rotate(15deg);
        }

        /* è©³ç´°è³‡è¨Šåˆ—è¡¨ */
        .details-list {
            flex: 1 1 200px; /* å½ˆæ€§å¯¬åº¦ */
            list-style: none;
            padding: 0;
            margin: 0;
            color: var(--text-white);
        }
        .details-list li {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            font-size: 1rem;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            padding-bottom: 8px;
        }
        .info-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        .info-label {
            color: var(--gold);
            font-weight: bold;
            margin-right: 5px;
        }

        /* å…§å®¹æ¨¡çµ„å€å¡Š (2x2 Grid) */
        .modules-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 15px 20px;
        }
        .module-box {
            background: var(--card-bg);
            border: 1px solid var(--gold);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            color: var(--text-white);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .module-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }
        .module-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        .module-desc {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* æ¨™èªæ©«å¹…å€ */
        .slogan-banner {
            margin: 20px 15px;
            padding: 15px;
            background: linear-gradient(90deg, #0f2c5e, #1a3a6e);
            border-radius: 50px;
            border: 2px solid var(--gold);
            text-align: center;
            color: var(--text-white);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .slogan-icon {
            font-size: 2.5rem;
            /* ç”¨ emoji çµ„åˆæ¨¡æ“¬æ©Ÿå™¨äººæ‰‹æ‹¿æ™‚é˜æ„›å¿ƒ */
            display: flex;
            align-items: center;
        }
        .slogan-text h3 {
            margin: 0;
            color: var(--gold);
            font-size: 1.2rem;
        }
        .slogan-text p {
            margin: 5px 0 0;
            font-size: 1rem;
            font-weight: bold;
        }

        /* é å°¾ */
        .footer-cta {
            text-align: center;
            color: var(--text-white);
            padding: 10px;
            font-weight: bold;
            letter-spacing: 1px;
        }

        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        @media (max-width: 400px) {
            .main-title { font-size: 1.4rem; }
            .sub-title { font-size: 1.1rem; }
            .info-section { flex-direction: column; text-align: center; }
            .details-list li { justify-content: center; }
            .modules-grid { grid-template-columns: 1fr; } /* å°è¢å¹•è®Šå–®æ¬„ */
            .slogan-banner { flex-direction: column; border-radius: 20px;}
        }
    </style>
</head>
<body class="vibrant-bg min-h-screen text-gray-800">

    

    <div id="app" class="max-w-6xl mx-auto px-4 py-8">
        <!-- å°è¦½åˆ— -->
        <nav class="flex flex-col lg:flex-row justify-between items-center mb-8 gap-6 bg-white/80 backdrop-blur-md p-4 rounded-3xl shadow-sm sticky top-4 z-40 border border-blue-50">
            <h1 onclick="showSection('home')" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500 flex items-center gap-2 cursor-pointer">
                <i data-lucide="sparkles" class="text-yellow-400 fill-yellow-400"></i> 20251226è”¡æ–‡åœ‹å°Gemå¢èƒ½ç ”ç¿’
            </h1>
            <div id="nav-links" class="flex flex-wrap justify-center gap-2 text-sm font-bold">
                <button onclick="showSection('home')" class="nav-button">é¦–é </button>
                <button onclick="goToUnit(0)" class="nav-button">1.ç­ç´šç¶“ç‡Ÿ</button>
                <button onclick="goToUnit(1)" class="nav-button">2.å­¸ç§‘æ•™å­¸</button>
                <button onclick="goToUnit(2)" class="nav-button">3.è¦ªå¸«æºé€š</button>
                <button onclick="goToUnit(3)" class="nav-button">4.ç­ç´šæ´»å‹•</button>
                <button id="nav-results-btn" onclick="showResults()" class="px-5 py-2 bg-gradient-to-r from-orange-400 to-pink-500 text-white rounded-full hover:scale-105 transition flex items-center gap-2 shadow-md">
                    <i data-lucide="award" class="w-4 h-4"></i> æŸ¥çœ‹ç ”ç¿’æˆæœç‰†
                </button>
            </div>
        </nav>

        <!-- é¦–é  -->
        <section id="home-section" class="section-block space-y-8 animate-fade-in">
            <div class="card-pop p-8 md:p-12 border-t-8 border-blue-500">
                <div class="max-w-3xl mx-auto text-center mb-12">
                    <h2 class="text-4xl font-black mb-4 text-gray-900 leading-tight">è®“ AI æˆç‚ºæ‚¨çš„è¶…å¼·æ•™ç·´ï¼âœ¨</h2>
                    <p class="text-xl text-gray-500">æ­¡è¿è”¡æ–‡åœ‹å°çš„å¤¥ä¼´ï¼Œé«”é©— AI è‡ªå‹•å³æ™‚è©•é‘‘åŠŸèƒ½ã€‚</p>
                </div>

<!-- æ•™å¸«æ—¥å¸¸å…±æ„Ÿå€ -->
<section class="card-pop p-8 md:p-10 border-l-8 border-amber-400 animate-fade-in">
    <h3 class="text-2xl font-black mb-6 text-gray-800 flex items-center gap-2">
        <span>ğŸ§‘â€ğŸ«</span> è€å¸«çš„ä¸€å¤©ï¼Œå¾ä¾†ä¸åªä¸Šèª²
    </h3>

    <p class="text-gray-600 mb-6 leading-relaxed">
        åœ¨æ­£å¼é«”é©— Gem ä¹‹å‰ï¼Œ  
        æˆ‘å€‘å…ˆä¸€èµ·çœ‹çœ‹â€”â€”  
        <span class="font-bold text-gray-800">è€å¸«æ¯å¤©é»˜é»˜åœ¨åšã€å»å¾ˆå°‘è¢«çœ‹è¦‹çš„é‚£äº›äº‹ã€‚</span>
    </p>

    <ul class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700 text-sm">
        <li class="bg-gray-50 p-4 rounded-xl">ğŸ“’ æ”¹ä½œæ¥­ã€çœ‹è¯çµ¡ç°¿ã€å›å®¶é•·è¨Šæ¯</li>
        <li class="bg-gray-50 p-4 rounded-xl">ğŸ“Š å¡«å¯«å„å¼è¡¨å–®ã€å›å ±ã€ç³»çµ±è³‡æ–™</li>
        <li class="bg-gray-50 p-4 rounded-xl">ğŸ§  æƒ³æ•™å­¸èª¿æ•´ã€å·®ç•°åŒ–ã€è£œæ•‘ç­–ç•¥</li>
        <li class="bg-gray-50 p-4 rounded-xl">ğŸ’¬ è™•ç†å­¸ç”Ÿè¡çªã€æƒ…ç·’å®‰æ’«</li>
        <li class="bg-gray-50 p-4 rounded-xl">ğŸ‰ è¦åŠƒæ´»å‹•ã€æ ¡å¤–æ•™å­¸ã€ç¯€æ…¶æµç¨‹</li>
        <li class="bg-gray-50 p-4 rounded-xl">â° ä¸‹ç­å¾Œï¼Œè…¦è¢‹é‚„åœ¨æƒ³æ˜å¤©çš„å­©å­</li>
    </ul>

    <div class="mt-8 bg-amber-50 border border-amber-200 rounded-2xl p-6 text-center">
        <p class="font-bold text-amber-700 text-lg">
            å¦‚æœæœ‰ä¸€å€‹ AIï¼Œ
        </p>
        <p class="text-gray-700 mt-2">
            èƒ½å¹«ä½ åˆ†æ“”é€™äº›ã€ŒèŠ±æ™‚é–“å»å¾ˆé‡è¦çš„äº‹ã€ï¼Œ  
            <br class="hidden md:block">
            ä½ æœƒæƒ³æŠŠæ™‚é–“ï¼Œç•™çµ¦èª°ï¼Ÿ
        </p>
    </div>
</section>



                
    <div class="poster-container">
        <div class="circuit-lines"></div>

        <div class="content-layer">
            <header class="xmas-banner">
                ğŸ„ Merry Christmas! ç¥å¤§å®¶è–èª•å¿«æ¨‚ ğŸ„
            </header>

            <section class="header-section">
                <div class="school-name">è”¡æ–‡åœ‹å°</div>
                <h1 class="main-title">
                    <span class="gem-icon">ğŸ’</span> Google Gems
                </h1>
                <h2 class="sub-title">åœ¨ç­ç´šç¶“ç‡Ÿèˆ‡è¦ªå¸«æºé€šçš„æ‡‰ç”¨</h2>
            </section>

            <section class="info-section">
                <div class="profile-wrapper">
                    <img src="https://class.kh.edu.tw/sites/28380/album_file/1/IMG_20251121_083417.JPG_compressed_.JPEG" alt="Handsome Jack è¬›å¸«" class="profile-img">
                </div>
                <ul class="details-list">
                    <li>
                        <span class="info-icon">ğŸ‘¨â€ğŸ«</span>
                        <span class="info-label">è¬›å¸«ï¼š</span>Handsome Jack
                    </li>
                    <li>
                        <span class="info-icon">ğŸ“…</span>
                        <span class="info-label">æ—¥æœŸï¼š</span>2025/12/26 (äº”)
                    </li>
                    <li>
                        <span class="info-icon">â°</span>
                        <span class="info-label">æ™‚é–“ï¼š</span>14ï¼š20 é–‹å§‹
                    </li>
                    <li>
                        <span class="info-icon">ğŸ“</span>
                        <span class="info-label">åœ°é»ï¼š</span>é›»è…¦æ•™å®¤ 1 ğŸ””
                    </li>
                </ul>
            </section>

            <section class="modules-grid">
                <div class="module-box">
                    <span class="module-icon">ğŸ›¡ï¸</span>
                    <div class="module-title">ç­ç´šç¶“ç‡Ÿ</div>
                    <div class="module-desc">å»ºç«‹å¸¸è¦ãƒ»ç§©åºç®¡ç†</div>
                </div>
                <div class="module-box">
                    <span class="module-icon">ğŸ“š</span>
                    <div class="module-title">å­¸ç§‘æ•™å­¸</div>
                    <div class="module-desc">æ•™æ¡ˆè¼”åŠ©ãƒ»å·®ç•°åŒ–å­¸ç¿’</div>
                </div>
                <div class="module-box">
                    <span class="module-icon">ğŸ’¬</span>
                    <div class="module-title">è¦ªå¸«æºé€š</div>
                    <div class="module-desc">é«˜æ•ˆè¨Šæ¯ãƒ»æº«æš–å›æ‡‰</div>
                </div>
                <div class="module-box">
                    <span class="module-icon">âœ¨</span>
                    <div class="module-title">ç­ç´šæ´»å‹•è¨­è¨ˆ</div>
                    <div class="module-desc">å‰µæ„ç™¼æƒ³ãƒ»æµç¨‹è¦åŠƒ</div>
                </div>
            </section>

            <section class="slogan-banner">
                <div class="slogan-icon">
                    ğŸ¤–ğŸ•’â¤ï¸
                </div>
                <div class="slogan-text">
                    <h3>å–„ç”¨ AI æ™ºæ…§å·¥å…·</h3>
                    <p>å°‡å¯¶è²´çš„æ™‚é–“ï¼Œç•™çµ¦çœ¼å‰çš„å­©å­</p>
                </div>
            </section>

            <footer class="footer-cta">
                æ­¡è¿æœ‰èˆˆè¶£æ•™å¸«è¸´èºåƒåŠ ï¼
            </footer>
        </div>
    </div>


                
                <div class="bg-gray-50 rounded-3xl p-8 border border-dashed border-gray-300">
                    <h3 class="text-2xl font-bold mb-6 text-center">é–‹å§‹ä¹‹å‰ï¼Œå…ˆè¨±å€‹é¡˜å§ï¼</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-2">æˆ‘æ˜¯...</label>
                                <input type="text" id="user-name" class="w-full p-4 rounded-2xl border-2 border-white bg-white shadow-sm focus:border-blue-400 outline-none transition" placeholder="æ‚¨çš„å§“å">
                            </div>
                            <button onclick="submitWish()" id="btn-submit-wish" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl hover:bg-blue-700 transition-all hover:shadow-xl hover:scale-[1.02] active:scale-95 shadow-lg shadow-blue-200 text-lg">
                                é–‹å•Ÿ Gem ç ”ç¿’å–®å…ƒ
                            </button>
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-2">æ‚¨çš„ AI é¡˜æœ›æ˜¯ï¼Ÿ</label>
                            <textarea id="ai-wish" rows="4" class="w-full p-4 rounded-2xl border-2 border-white bg-white shadow-sm focus:border-blue-400 outline-none transition" placeholder="ä¾‹å¦‚ï¼šå¸Œæœ› AI èƒ½å¹«æˆ‘æ‰¹æ”¹åœ‹èªç¿’ä½œçš„é€ å¥..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- å­¸ç¿’å–®å…ƒå€åŸŸ -->
        <section id="units-section" class="section-block hidden space-y-8">
            <div id="unit-content">
                <!-- å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
            </div>
        </section>

        <!-- æ¸¬é©—çµæœæŸ¥è©¢å€åŸŸ -->
        <section id="results-section" class="section-block hidden space-y-6 animate-fade-in">
            <div class="card-pop p-8 border-t-8 border-orange-400">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-black text-gray-800 flex items-center gap-2">
                            <i data-lucide="layout-list" class="text-orange-500"></i> è”¡æ–‡å¤¥ä¼´ç ”ç¿’ç‰†
                        </h2>
                        <p class="text-gray-500 mt-1">AI å·²è‡ªå‹•ç‚ºè€å¸«å€‘çš„è¨­å®šé€²è¡Œã€Œè§’è‰²ä»»å‹™åˆ†æã€å›é¥‹ï¼</p>
                    </div>
                    <div class="flex flex-wrap gap-2 w-full md:w-auto">
                        <button onclick="showResults()" class="p-3 bg-gray-100 rounded-xl hover:bg-gray-200 transition" title="é‡æ–°æ•´ç†">
                            <i data-lucide="refresh-cw" class="w-5 h-5 text-gray-600"></i>
                        </button>
                        <div class="relative flex-1 md:w-80">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"></i>
                            <input type="text" id="search-input" onkeyup="filterResults()" placeholder="æœå°‹å§“åã€å…§å®¹æˆ–è©•èª..." class="w-full pl-10 p-3 bg-gray-50 border-2 border-gray-100 rounded-xl text-sm outline-none focus:border-blue-400 transition">
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto rounded-2xl border border-gray-100 min-h-[400px]">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr class="bg-gray-50 text-gray-600 text-sm font-black">
                                <th class="py-4 px-6 border-b">è€å¸«</th>
                                <th class="py-4 px-6 border-b">å­¸ç¿’ä¸»é¡Œ</th>
                                <th class="py-4 px-6 border-b">Gem è¨­å®šå…§å®¹</th>
                                <th class="py-4 px-6 border-b">AI æ•™ç·´é»è©•</th>
                            </tr>
                        </thead>
                        <tbody id="results-table-body"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- æˆåŠŸæç¤ºæ¡† -->
        <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-gray-900/90 backdrop-blur text-white px-8 py-4 rounded-2xl opacity-0 transition-opacity pointer-events-none z-50 shadow-2xl font-bold">
            è³‡æ–™å·²å„²å­˜ï¼
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCxrOlO-PyQZBknKYpC84XYB7wAxBh6tOA",
            authDomain: "myreadingcheckin.firebaseapp.com",
            projectId: "myreadingcheckin",
            storageBucket: "myreadingcheckin.firebasestorage.app",
            messagingSenderId: "476306591390",
            appId: "1:476306591390:web:697f4c3bbf246c4c81358f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "cai-wen-teacher-ai-coach"; // å»ºç«‹æ–°çš„ App ID ä»¥å€éš”
        const resultsCollectionPath = ['artifacts', appId, 'public', 'data', 'quizResults'];
        const apiKey = ""; // Gemini API Key æœƒç”±ç³»çµ±æ³¨å…¥

        signInAnonymously(auth);

        const units = [
            { id: 1, title: "ç­ç´šç¶“ç‡Ÿï¼šæƒ…ç·’å®‰æ’«å°åŠ©æ‰‹", desc: "è¨­è¨ˆå°ˆæ¥­çš„å¿ƒç†è¼”å°è§’è‰²ã€‚", gemExample: "ä½ ç¾åœ¨æ˜¯ä¸€ä½æº«å’Œçš„è«®å•†å¿ƒç†è€å¸«...", quiz: "å¦‚æœ AI æ˜¯ä¸€ä½è³‡æ·±ç­å°å¸«ï¼Œå®ƒæ‡‰è©²å…·å‚™ä»€éº¼æ¨£çš„è§’è‰²æ€§æ ¼èˆ‡èªªè©±èªæ°£ï¼Ÿ" },
            { id: 2, title: "å­¸ç§‘æ•™å­¸ï¼šå‰µæ„æ•™æ¡ˆè¨­è¨ˆå¸«", desc: "æŠŠç”Ÿæ¾€èª²ç¨‹è®Šèº«å†’éšªéŠæˆ²ã€‚", gemExample: "ä½ æ˜¯ä¸€ä½å……æ»¿å¥½å¥‡å¿ƒçš„å†’éšªå®¶ï¼Œè«‹è¨­è¨ˆæ•¸å­¸éŠæˆ²...", quiz: "å¦‚æœè¦è®“ AI è¨­è¨ˆã€åœ‹èªä¿®è¾­ã€æ•™æ¡ˆï¼Œæ‚¨æœƒå¦‚ä½•è¨­å®šå®ƒçš„å°ˆå®¶è§’è‰²èƒŒæ™¯ï¼Ÿ" },
            { id: 3, title: "è¦ªå¸«æºé€šï¼šå§”å©‰æ–‡å­—ç¿»è­¯å®˜", desc: "å°‡æƒ³èªªçš„è©±ï¼Œä¿®é£¾å¾—æ›´æœ‰æº«åº¦ã€‚", gemExample: "ä½ æ˜¯ä¸€ä½è³‡æ·±è¦ªå¸«æºé€šå°ˆå®¶...", quiz: "ç•¶å­©å­ç™¼ç”Ÿåå·®è¡Œç‚ºéœ€å‘ŠçŸ¥å®¶é•·ï¼Œæ‚¨æœƒè¦æ±‚ AI ä»¥ä»€éº¼æ¨£çš„å£å»æ‰®æ¼”ã€Œæ ¡åœ’å°å¸«ã€ï¼Ÿ" },
            { id: 4, title: "ç­ç´šæ´»å‹•ï¼šæ´»å‹•ä¼åŠƒå¤§å¸«", desc: "è®“ç¯€æ…¶æ´»å‹•ä¸å†åƒç¯‡ä¸€å¾‹ã€‚", gemExample: "ä½ æ˜¯ä¸€ä½å¾—ççš„å…’ç«¥æ´»å‹•ç­–å±•äºº...", quiz: "è¦åŠƒè”¡æ–‡åœ‹å°æ ¡æ…¶é—–é—œæ™‚ï¼Œæ‚¨æœƒå¸Œæœ› AI æ‰®æ¼”ä»€éº¼æ¨£çš„è§’è‰²ä¾†æä¾›å‰µæ„ï¼Ÿ" }
        ];

        let currentUnitIndex = 0;
        let globalUserName = "";
        let allResults = [];

        const refreshIcons = () => { if (typeof lucide !== 'undefined') lucide.createIcons(); };

        // AI è©•åˆ†æ ¸å¿ƒé‚è¼¯
        async function getAICoachReview(unitTitle, answer) {
            const systemPrompt = `ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ Prompt Engineering (æç¤ºè©å·¥ç¨‹) è¬›å¸«ï¼Œå°ˆé–€è©•ä¼°åœ‹å°è€å¸«å° Gemini (AI) çš„è§’è‰²è¨­å®šã€‚
            è«‹æ ¹æ“šä½¿ç”¨è€…çš„å›ç­”ï¼Œæª¢æŸ¥æ˜¯å¦åŒ…å«ï¼š1.è§’è‰²è¨­å®š (Role) 2.ä»»å‹™ç›®æ¨™ (Task) 3.èƒŒæ™¯ç´°ç¯€ (Context)ã€‚
            ä¸¦ä»¥ JSON æ ¼å¼å›å‚³è©•èªã€‚
            JSON çµæ§‹ç‚ºï¼š{"score": åˆ†æ•¸1-5, "feedback": "ç´„50å­—ä¸­æ–‡å»ºè­°", "badge": "ç¨±è™Ÿå¦‚: è§’è‰²å¤§å¸«/æ–°æ‰‹æ•™ç·´"}ã€‚`;
            
            const userQuery = `å­¸ç¿’å–®å…ƒï¼š${unitTitle}\nè€å¸«çš„è¨­å®šå…§å®¹ï¼š${answer}`;
            
            let retries = 5;
            let delay = 1000;
            
            while (retries > 0) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] },
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });
                    const data = await response.json();
                    return JSON.parse(data.candidates[0].content.parts[0].text);
                } catch (e) {
                    retries--;
                    if (retries === 0) return { score: 3, feedback: "AI æ•™ç·´ç›®å‰ä¼‘æ¯ä¸­ï¼Œæ‚¨çš„ç†±æƒ…æˆ‘å€‘æ”¶åˆ°äº†ï¼", badge: "å‹¤å¥®å¤¥ä¼´" };
                    await new Promise(r => setTimeout(r, delay));
                    delay *= 2;
                }
            }
        }

        window.showSection = (id) => {
            const sections = document.querySelectorAll('.section-block');
            sections.forEach(sec => sec.classList.add('hidden'));
            document.getElementById(`${id}-section`).classList.remove('hidden');
            refreshIcons();
        };

        window.goToUnit = (index) => {
            if (!globalUserName) { showToast("è«‹å…ˆè¼¸å…¥å§“åï¼"); return; }
            currentUnitIndex = index;
            renderUnit();
            showSection('units');
        };

        window.submitWish = async () => {
            const name = document.getElementById('user-name').value;
            const wish = document.getElementById('ai-wish').value;
            if (!name) { showToast("è«‹è¼¸å…¥å§“åï¼"); return; }
            globalUserName = name;
            await addDoc(collection(db, ...resultsCollectionPath), { 
                unitName: "ç ”ç¿’åˆè¡·", name, answer: wish || "åŠ æ²¹ï¼", timestamp: serverTimestamp(), aiReview: { score: 5, feedback: "éå¸¸æ£’çš„é–‹å§‹ï¼é¡˜æœ›æ¸…å–®å·²åŒæ­¥åˆ° AI é›²ç«¯ã€‚", badge: "å¤¢æƒ³å®¶" } 
            });
            goToUnit(0);
        };

        window.renderUnit = () => {
            const unit = units[currentUnitIndex];
            document.getElementById('unit-content').innerHTML = `
                <div class="card-pop p-8 md:p-12 border-t-8 border-blue-500 animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-black">${unit.title}</h3>
                        <span class="text-sm font-bold bg-blue-50 text-blue-600 px-4 py-1 rounded-full">UNIT ${unit.id}/4</span>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <p class="text-gray-600 mb-4">${unit.desc}</p>
                            <div class="bg-blue-50 p-6 rounded-2xl mb-6">
                                <h5 class="text-xs font-black text-blue-700 mb-2 uppercase">è¨­å®šç¯„ä¾‹</h5>
                                <p class="text-sm italic">ã€Œ${unit.gemExample}ã€</p>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-8 rounded-3xl border-2 border-yellow-200">
                            <h4 class="font-bold mb-3">${unit.quiz}</h4>
                            <textarea id="quiz-answer" rows="5" class="w-full p-4 rounded-2xl mb-4 border-2 border-transparent focus:border-orange-400 outline-none" placeholder="è¼¸å…¥æ‚¨çš„è¨­å®š..."></textarea>
                            <div id="loading-ai" class="hidden items-center gap-3 mb-4 text-blue-600 font-bold">
                                <div class="spinner"></div> AI æ•™ç·´è©•é‘‘ä¸­...
                            </div>
                            <button id="submit-btn" onclick="submitQuiz()" class="w-full py-4 bg-gray-900 text-white rounded-2xl font-bold hover:bg-black transition">
                                æäº¤ä¸¦ç”± AI è©•é–±
                            </button>
                        </div>
                    </div>
                </div>
            `;
            refreshIcons();
        };

        window.submitQuiz = async () => {
            const answer = document.getElementById('quiz-answer').value;
            if (!answer) return;
            
            const btn = document.getElementById('submit-btn');
            const loader = document.getElementById('loading-ai');
            btn.disabled = true;
            loader.classList.remove('hidden');

            try {
                const aiReview = await getAICoachReview(units[currentUnitIndex].title, answer);
                await addDoc(collection(db, ...resultsCollectionPath), {
                    unitName: units[currentUnitIndex].title,
                    name: globalUserName,
                    answer,
                    aiReview,
                    timestamp: serverTimestamp()
                });
                showToast("AI å·²å®Œæˆè©•é–±ä¸¦å­˜æª”ï¼");
                if (currentUnitIndex < units.length - 1) { currentUnitIndex++; renderUnit(); }
                else { showFinalSuccess(); }
            } catch (e) { showToast("æäº¤ç™¼ç”ŸéŒ¯èª¤"); }
        };

        window.showResults = async () => {
            showSection('results');
            const tbody = document.getElementById('results-table-body');
            tbody.innerHTML = '<tr><td colspan="4" class="py-20 text-center text-gray-400"><div class="spinner mx-auto mb-2"></div>è¼‰å…¥å¤¥ä¼´å‰µæ„èˆ‡ AI å›é¥‹ä¸­...</td></tr>';
            
            try {
                const snap = await getDocs(collection(db, ...resultsCollectionPath));
                allResults = snap.docs.map(d => d.data()).sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                renderTable(allResults);
            } catch (e) { tbody.innerHTML = '<tr><td colspan="4" class="py-20 text-center">ç›®å‰å°šç„¡è³‡æ–™</td></tr>'; }
        };

        window.filterResults = () => {
            const kw = document.getElementById('search-input').value.toLowerCase();
            const filtered = allResults.filter(r => 
                r.name.toLowerCase().includes(kw) || r.answer.toLowerCase().includes(kw) || (r.aiReview?.feedback || "").toLowerCase().includes(kw)
            );
            renderTable(filtered);
        };

        function renderTable(data) {
            document.getElementById('results-table-body').innerHTML = data.map(r => `
                <tr class="border-b hover:bg-white transition group">
                    <td class="py-6 px-6 align-top">
                        <div class="font-bold text-gray-800">${r.name}</div>
                        <div class="text-[10px] text-gray-400 uppercase tracking-tighter">${r.aiReview?.badge || 'ç ”ç¿’ç”Ÿ'}</div>
                    </td>
                    <td class="py-6 px-6 align-top">
                        <span class="text-xs font-bold text-blue-500">${r.unitName}</span>
                    </td>
                    <td class="py-6 px-6 align-top max-w-md">
                        <div class="content-wrap text-sm text-gray-600 bg-gray-50 p-4 rounded-xl select-all">${r.answer}</div>
                    </td>
                    <td class="py-6 px-6 align-top">
                        <div class="bg-white border border-orange-100 p-4 rounded-xl shadow-sm">
                            <div class="flex gap-1 mb-2">
                                ${Array(5).fill(0).map((_, i) => `<i data-lucide="star" class="w-3 h-3 ${i < (r.aiReview?.score || 0) ? 'fill-orange-400 text-orange-400' : 'text-gray-200'}"></i>`).join('')}
                            </div>
                            <p class="text-xs text-orange-800 font-medium leading-relaxed">${r.aiReview?.feedback || 'æ•™ç·´æ­£åœ¨è§€å¯Ÿæ‚¨çš„æ½›åŠ›...'}</p>
                        </div>
                    </td>
                </tr>
            `).join('');
            refreshIcons();
        }

        function showFinalSuccess() {
            document.getElementById('unit-content').innerHTML = `
                <div class="card-pop p-16 text-center animate-fade-in border-t-8 border-green-400">
                    <i data-lucide="award" class="w-20 h-20 text-green-500 mx-auto mb-6"></i>
                    <h2 class="text-4xl font-black mb-4">ç ”ç¿’å¤§æˆåŠŸï¼</h2>
                    <p class="text-gray-500 mb-8">æ‚¨å·²ç¶“é€šéæ‰€æœ‰ AI æŒ‘æˆ°ï¼Œå¿«å»æˆæœç‰†çœ‹çœ‹æ‚¨çš„æ•™ç·´è©•åƒ¹å§ï¼</p>
                    <button onclick="showResults()" class="px-10 py-4 bg-gray-900 text-white rounded-2xl font-bold shadow-xl">é€²å…¥æˆæœç‰†</button>
                </div>
            `;
            setTimeout(refreshIcons, 0);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 3000);
        }

        window.addEventListener('load', refreshIcons);
    </script>
</body>
</html>
